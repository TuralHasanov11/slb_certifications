AddLiscencePage As screen:
    OnVisible: |-
        =Set(currentPage, {page: "AddCertificatePage"});
        UpdateContext({liscenceFile: LookUp(CertificatesStorage,Certificate.Id=CertificateList.Selected.ID)})   

    AppLayout_4 As AppLayout:
        PageTitle: =If(CertificateForm.Mode=FormMode.Edit,"Edit Liscence - "&CertificateList.Selected.Title,"Add Liscence")

    CertificateForm As form:
        DataSource: =Certificates
        Height: =460
        Item: =CertificateList.Selected
        NumberOfColumns: =2
        OnFailure: |-
            =Notify(
                "Failed: Liscence was not saved due to an error",
                NotificationType.Error
            );
        OnSuccess: |-
            =If(!IsEmpty(LiscenceFileInput.Attachments), UploadDocumentToLiscenceStorage.Run({contentBytes: First(LiscenceFileInput.Attachments).Value, name: CertificateForm.LastSubmit.ID&"-"&CertificateForm.LastSubmit.Department.Value&"-"&CertificateForm.LastSubmit.Subject.Value&"."&Last(Split(First(LiscenceFileInput.Attachments).Name, ".")).Result},CertificateForm.LastSubmit.ID));
            If(CertificateForm.Mode=FormMode.Edit && ExpDateIsNew.Value=true,Patch(CertificateExpirationDates,Defaults(CertificateExpirationDates),{ExpirationDate:PrevExpirationDate.SelectedDate, Certificate:{'@odata.type':"#Microsoft.Azure.Connectors.SharePoint.SPListExpandedReference",Id:CertificateList.Selected.ID,Value:CertificateList.Selected.Title}}));
            Notify(
                "Succes: Liscence was saved",
                NotificationType.Success
            );
            If(CertificateForm.Mode=FormMode.Edit, Navigate(LiscenceDetailPage,Fade));
            Navigate(LiscencesPage,Fade);
        Width: =990
        X: =260
        Y: =179
        ZIndex: =2

        DataCard4 As typedDataCard.blankCard:
            BorderStyle: =BorderStyle.Solid
            DisplayMode: =DisplayMode.Edit
            Fill: =RGBA(0, 0, 0, 0)
            Height: =100
            Visible: =CertificateForm.Mode=FormMode.Edit
            Width: =495
            X: =0
            Y: =2
            ZIndex: =1

            ExpDateIsNew As toggleSwitch:
                FalseText: ="Not new"
                Height: =32
                Size: =10
                Tooltip: ="Renew or Modify Expiration Date"
                TrueText: ="New"
                Visible: =CertificateForm.Mode=FormMode.Edit
                Width: =109
                X: =33
                Y: =12
                ZIndex: =1

        Attachments_DataCard5 As typedDataCard.attachmentsEditCard:
            BorderStyle: =BorderStyle.Solid
            DataField: ="{Attachments}"
            Default: =ThisItem.Attachments
            DisplayMode: =Parent.DisplayMode
            DisplayName: =DataSourceInfo([@Certificates],DataSourceInfo.DisplayName,"{Attachments}")
            Fill: =RGBA(0, 0, 0, 0)
            Height: =157
            Required: =false
            Update: =LiscenceFileInput.Attachments
            Width: =495
            X: =1
            Y: =3
            ZIndex: =1

            DataCardKey16 As label:
                AutoHeight: =true
                Height: =34
                Text: =Parent.DisplayName & " - Only pdf files are allowed!"
                Width: =Parent.Width - 60
                Wrap: =false
                X: =30
                Y: =10
                ZIndex: =1

            LiscenceFileInput As attachments:
                BorderColor: =If(IsBlank(Parent.Error), Parent.BorderColor, Color.Red)
                DisplayMode: =Parent.DisplayMode
                Height: =100
                IsInDataCard: =true
                Items: =
                MaxAttachments: =1
                OnAddFile: |-
                    =If(
                        Not(
                            EndsWith(
                                First(Self.Attachments).Name,
                                ".pdf"
                            )
                        ),
                        Notify(
                            "Only pdf files are allowed!",
                            NotificationType.Error
                        );
                        Reset(Self)
                    )
                PaddingBottom: =5
                PaddingLeft: =If(Self.DisplayMode = DisplayMode.Edit, 5, 0)
                PaddingRight: =5
                PaddingTop: =5
                Tooltip: =Parent.DisplayName
                Width: =Parent.Width - 60
                X: =30
                Y: =59
                ZIndex: =2

            ErrorMessage14 As label:
                AutoHeight: =true
                Height: =10
                Live: =Live.Assertive
                PaddingBottom: =0
                PaddingLeft: =0
                PaddingRight: =0
                PaddingTop: =0
                Text: =Parent.Error
                Visible: =Parent.DisplayMode=DisplayMode.Edit
                Width: =Parent.Width - 60
                X: =30
                Y: =LiscenceFileInput.Y + LiscenceFileInput.Height
                ZIndex: =3

            StarVisible14 As label:
                Align: =Align.Center
                Height: =DataCardKey16.Height
                Text: ="*"
                Visible: =And(Parent.Required, Parent.DisplayMode=DisplayMode.Edit)
                Width: =30
                Wrap: =false
                Y: =DataCardKey16.Y
                ZIndex: =4

        Description_DataCard3 As typedDataCard.richTextEditorEditCard:
            BorderStyle: =BorderStyle.Solid
            DataField: ="Description"
            Default: =ThisItem.Description
            DisplayMode: =Parent.DisplayMode
            DisplayName: =DataSourceInfo([@Certificates],DataSourceInfo.DisplayName,"Description")
            Fill: =RGBA(0, 0, 0, 0)
            Height: =245
            Required: =false
            Update: =DataCardValue26.HtmlText
            Width: =990
            X: =0
            Y: =4
            ZIndex: =1

            DataCardKey26 As label:
                AutoHeight: =true
                Height: =34
                Text: =Parent.DisplayName
                Width: =Parent.Width - 60
                Wrap: =false
                X: =30
                Y: =10
                ZIndex: =1

            DataCardValue26 As richTextEditor:
                Default: =Parent.Default
                DisplayMode: =Parent.DisplayMode
                Height: =196
                Width: =Parent.Width - 60
                X: =30
                Y: =DataCardKey26.Y + DataCardKey26.Height + 5
                ZIndex: =2

            ErrorMessage22 As label:
                AutoHeight: =true
                Height: =10
                Live: =Live.Assertive
                PaddingBottom: =0
                PaddingLeft: =0
                PaddingRight: =0
                PaddingTop: =0
                Text: =Parent.Error
                Visible: =Parent.DisplayMode=DisplayMode.Edit
                Width: =Parent.Width - 60
                X: =30
                Y: =DataCardValue26.Y + DataCardValue26.Height
                ZIndex: =3

            StarVisible22 As label:
                Align: =Align.Center
                Height: =DataCardKey26.Height
                Text: ="*"
                Visible: =And(Parent.Required, Parent.DisplayMode=DisplayMode.Edit)
                Width: =30
                Wrap: =false
                Y: =DataCardKey26.Y
                ZIndex: =4

        Title_DataCard2 As typedDataCard.textualEditCard:
            BorderStyle: =BorderStyle.Solid
            DataField: ="Title"
            Default: =ThisItem.Title
            DisplayMode: =Parent.DisplayMode
            DisplayName: =DataSourceInfo([@Certificates],DataSourceInfo.DisplayName,"Title")
            Fill: =RGBA(0, 0, 0, 0)
            Height: =50
            MaxLength: =DataSourceInfo([@Certificates], DataSourceInfo.MaxLength, "Title")
            Required: =true
            Update: =DataCardValue4.Text
            Width: =495
            X: =0
            Y: =0
            ZIndex: =2

            DataCardKey4 As label:
                AutoHeight: =true
                Height: =34
                Text: =Parent.DisplayName
                Width: =Parent.Width - 60
                Wrap: =false
                X: =30
                Y: =10
                ZIndex: =1

            DataCardValue4 As text:
                BorderColor: =If(IsBlank(Parent.Error), Parent.BorderColor, Color.Red)
                Default: =Parent.Default
                DelayOutput: =true
                DisplayMode: =Parent.DisplayMode
                MaxLength: =Parent.MaxLength
                PaddingLeft: =5
                RadiusBottomLeft: =0
                RadiusBottomRight: =0
                RadiusTopLeft: =0
                RadiusTopRight: =0
                Tooltip: =Parent.DisplayName
                Width: =Parent.Width - 60
                X: =30
                Y: =DataCardKey4.Y + DataCardKey4.Height + 5
                ZIndex: =2

            ErrorMessage4 As label:
                AutoHeight: =true
                Height: =10
                Live: =Live.Assertive
                PaddingBottom: =0
                PaddingLeft: =0
                PaddingRight: =0
                PaddingTop: =0
                Text: =Parent.Error
                Visible: =Parent.DisplayMode=DisplayMode.Edit
                Width: =Parent.Width - 60
                X: =30
                Y: =DataCardValue4.Y + DataCardValue4.Height
                ZIndex: =3

            StarVisible4 As label:
                Align: =Align.Center
                Height: =DataCardKey4.Height
                Text: ="*"
                Visible: =And(Parent.Required, Parent.DisplayMode=DisplayMode.Edit)
                Width: =30
                Wrap: =false
                Y: =DataCardKey4.Y
                ZIndex: =4

        Subject_DataCard1 As typedDataCard.comboBoxEditCard:
            BorderStyle: =BorderStyle.Solid
            DataField: ="Subject"
            Default: =ThisItem.Subject
            DisplayMode: =Parent.DisplayMode
            DisplayName: =DataSourceInfo([@Certificates],DataSourceInfo.DisplayName,"Subject")
            Fill: =RGBA(0, 0, 0, 0)
            Height: =50
            Required: =true
            Update: =DataCardValue11.Selected
            Width: =495
            X: =1
            Y: =0
            ZIndex: =2

            DataCardKey11 As label:
                AutoHeight: =true
                Height: =34
                Text: =Parent.DisplayName
                Width: =Parent.Width - 60
                Wrap: =false
                X: =30
                Y: =10
                ZIndex: =1

            DataCardValue11 As combobox:
                BorderColor: =If(IsBlank(Parent.Error), Parent.BorderColor, Color.Red)
                DefaultSelectedItems: =Parent.Default
                DisplayFields: =["Value"]
                DisplayMode: =Parent.DisplayMode
                Items: =Choices([@Certificates].Subject)
                PaddingLeft: =If(Self.DisplayMode = DisplayMode.Edit, 5, 0)
                SearchFields: =["Value"]
                SearchItems: =Choices(Certificates.Subject,DataCardValue11.SearchText)
                SelectMultiple: =false
                Tooltip: =Parent.DisplayName
                Width: =Parent.Width - 60
                X: =30
                Y: =DataCardKey11.Y + DataCardKey11.Height + 5
                ZIndex: =2

            ErrorMessage11 As label:
                AutoHeight: =true
                Height: =10
                Live: =Live.Assertive
                PaddingBottom: =0
                PaddingLeft: =0
                PaddingRight: =0
                PaddingTop: =0
                Text: =Parent.Error
                Visible: =Parent.DisplayMode=DisplayMode.Edit
                Width: =Parent.Width - 60
                X: =30
                Y: =DataCardValue11.Y + DataCardValue11.Height
                ZIndex: =3

            StarVisible11 As label:
                Align: =Align.Center
                Height: =DataCardKey11.Height
                Text: ="*"
                Visible: =And(Parent.Required, Parent.DisplayMode=DisplayMode.Edit)
                Width: =30
                Wrap: =false
                Y: =DataCardKey11.Y
                ZIndex: =4

        ExpirationDate_DataCard1 As typedDataCard.dateEditCard:
            BorderStyle: =BorderStyle.Solid
            DataField: ="ExpirationDate"
            Default: =ThisItem.ExpirationDate
            DisplayMode: =Parent.DisplayMode
            DisplayName: =DataSourceInfo([@Certificates],DataSourceInfo.DisplayName,"ExpirationDate")
            Fill: =RGBA(0, 0, 0, 0)
            Height: =50
            Required: =false
            Update: =DataCardValue5.SelectedDate
            Width: =495
            X: =0
            Y: =1
            ZIndex: =2

            DataCardKey5 As label:
                Height: =34
                Text: ="Expiration Date"
                Width: =182
                Wrap: =false
                X: =30
                Y: =10
                ZIndex: =1

            DataCardValue5 As datepicker:
                BorderColor: =If(IsBlank(Parent.Error), Parent.BorderColor, Color.Red)
                DefaultDate: =Parent.Default
                DisplayMode: =Parent.DisplayMode
                EndYear: =Year(Today())+100
                IsEditable: =true
                PaddingBottom: =0
                PaddingLeft: =If(Self.DisplayMode = DisplayMode.Edit, 5, 0)
                StartYear: =1899
                Tooltip: =Parent.DisplayName
                Width: =Parent.Width - 60
                X: =30
                Y: =DataCardKey5.Y + DataCardKey5.Height + 5
                ZIndex: =2

            ErrorMessage5 As label:
                AutoHeight: =true
                Height: =10
                Live: =Live.Assertive
                PaddingBottom: =0
                PaddingLeft: =0
                PaddingRight: =0
                PaddingTop: =0
                Text: =Parent.Error
                Visible: =Parent.DisplayMode=DisplayMode.Edit
                Width: =Parent.Width - 60
                X: =30
                Y: =DataCardValue5.Y + DataCardValue5.Height
                ZIndex: =3

            StarVisible5 As label:
                Align: =Align.Center
                Height: =DataCardKey5.Height
                Text: ="*"
                Visible: =And(Parent.Required, Parent.DisplayMode=DisplayMode.Edit)
                Width: =30
                Wrap: =false
                Y: =DataCardKey5.Y
                ZIndex: =4

        Department_DataCard1 As typedDataCard.comboBoxEditCard:
            BorderStyle: =BorderStyle.Solid
            DataField: ="Department"
            Default: =ThisItem.Department
            DisplayMode: =Parent.DisplayMode
            DisplayName: =DataSourceInfo([@Certificates],DataSourceInfo.DisplayName,"Department")
            Fill: =RGBA(0, 0, 0, 0)
            Height: =50
            Required: =false
            Update: =DepartmentInput.Selected
            Width: =495
            X: =1
            Y: =1
            ZIndex: =2

            DataCardKey6 As label:
                AutoHeight: =true
                Height: =34
                Text: =Parent.DisplayName
                Width: =Parent.Width - 60
                Wrap: =false
                X: =30
                Y: =10
                ZIndex: =1

            DepartmentInput As combobox:
                BorderColor: =If(IsBlank(Parent.Error), Parent.BorderColor, Color.Red)
                DefaultSelectedItems: |-
                    =If(CertificateForm.Mode = FormMode.New, {Value:AuthUser.Group.Value} ,Parent.Default)
                DisplayFields: =["Value"]
                DisplayMode: =If(!("Admins" in AuthUser.Group.Value Or CertificateForm.Mode=FormMode.New),Disabled,Parent.DisplayMode)
                Items: =Choices([@Certificates].Department)
                PaddingLeft: =If(Self.DisplayMode = DisplayMode.Edit, 5, 0)
                SearchFields: =["Value"]
                SearchItems: =Choices(Certificates.Department,DepartmentInput.SearchText)
                SelectMultiple: =false
                Tooltip: =Parent.DisplayName
                Width: =Parent.Width - 60
                X: =30
                Y: =DataCardKey6.Y + DataCardKey6.Height + 5
                ZIndex: =2

            ErrorMessage6 As label:
                AutoHeight: =true
                Height: =10
                Live: =Live.Assertive
                PaddingBottom: =0
                PaddingLeft: =0
                PaddingRight: =0
                PaddingTop: =0
                Text: =Parent.Error
                Visible: =Parent.DisplayMode=DisplayMode.Edit
                Width: =Parent.Width - 60
                X: =30
                Y: =DepartmentInput.Y + DepartmentInput.Height
                ZIndex: =3

            StarVisible6 As label:
                Align: =Align.Center
                Height: =DataCardKey6.Height
                Text: ="*"
                Visible: =And(Parent.Required, Parent.DisplayMode=DisplayMode.Edit)
                Width: =30
                Wrap: =false
                Y: =DataCardKey6.Y
                ZIndex: =4

            DepartmentNonFieldError As label:
                AutoHeight: =true
                Height: =10
                Live: =Live.Assertive
                PaddingBottom: =0
                PaddingLeft: =0
                PaddingRight: =0
                PaddingTop: =0
                Text: =If(!("Admins" in AuthUser.Group.Value||DepartmentInput.Selected.Value in AuthUser.Group.Value), "You have to select your department!")
                Visible: =Parent.DisplayMode=DisplayMode.Edit
                Width: =Parent.Width - 60
                X: =40
                Y: =DepartmentInput.Y + DepartmentInput.Height
                ZIndex: =5

        IssueDate_DataCard1 As typedDataCard.dateEditCard:
            BorderStyle: =BorderStyle.Solid
            DataField: ="IssueDate"
            Default: =ThisItem.IssueDate
            DisplayMode: =Parent.DisplayMode
            DisplayName: =DataSourceInfo([@Certificates],DataSourceInfo.DisplayName,"IssueDate")
            Fill: =RGBA(0, 0, 0, 0)
            Height: =50
            Required: =true
            Update: =DataCardValue8.SelectedDate
            Width: =495
            X: =1
            Y: =2
            ZIndex: =2

            DataCardKey8 As label:
                AutoHeight: =true
                Height: =34
                Text: ="Issue Date"
                Width: =Parent.Width - 60
                Wrap: =false
                X: =30
                Y: =13
                ZIndex: =1

            DataCardValue8 As datepicker:
                BorderColor: =If(IsBlank(Parent.Error), Parent.BorderColor, Color.Red)
                DefaultDate: =Parent.Default
                DisplayMode: =Parent.DisplayMode
                EndYear: =Year(Today())+100
                IsEditable: =true
                PaddingBottom: =0
                PaddingLeft: =If(Self.DisplayMode = DisplayMode.Edit, 5, 0)
                StartYear: =1899
                Tooltip: =Parent.DisplayName
                Width: =Parent.Width - 60
                X: =30
                Y: =47
                ZIndex: =2

            ErrorMessage8 As label:
                AutoHeight: =true
                Height: =10
                Live: =Live.Assertive
                PaddingBottom: =0
                PaddingLeft: =0
                PaddingRight: =0
                PaddingTop: =0
                Text: =Parent.Error
                Visible: =Parent.DisplayMode=DisplayMode.Edit
                Width: =Parent.Width - 60
                X: =30
                Y: =DataCardValue8.Y + DataCardValue8.Height
                ZIndex: =3

            StarVisible8 As label:
                Align: =Align.Center
                Height: =DataCardKey8.Height
                Text: ="*"
                Visible: =And(Parent.Required, Parent.DisplayMode=DisplayMode.Edit)
                Width: =30
                Wrap: =false
                Y: =DataCardKey8.Y
                ZIndex: =4

        InterestedPeople_DataCard1 As typedDataCard.comboBoxMultiSelectEditCard:
            BorderStyle: =BorderStyle.Solid
            DataField: ="InterestedPeople"
            Default: =ThisItem.InterestedPeople
            DisplayMode: =Parent.DisplayMode
            DisplayName: =DataSourceInfo([@Certificates],DataSourceInfo.DisplayName,"InterestedPeople")
            Fill: =RGBA(0, 0, 0, 0)
            Height: =50
            Required: =true
            Update: =DataCardValue10.SelectedItems
            Width: =495
            X: =0
            Y: =3
            ZIndex: =2

            DataCardKey10 As label:
                AutoHeight: =true
                Height: =34
                Text: ="Interested People"
                Width: =Parent.Width - 60
                Wrap: =false
                X: =30
                Y: =10
                ZIndex: =1

            DataCardValue10 As combobox:
                BorderColor: =If(IsBlank(Parent.Error), Parent.BorderColor, Color.Red)
                DefaultSelectedItems: =Parent.Default
                DisplayFields: =["DisplayName","Email","Picture"]
                DisplayMode: =Parent.DisplayMode
                InputTextPlaceholder: ="Search Interested people"
                Items: =Choices([@Certificates].InterestedPeople)
                PaddingLeft: =If(Self.DisplayMode = DisplayMode.Edit, 5, 0)
                SearchFields: =["DisplayName"]
                SearchItems: =Choices(Certificates.InterestedPeople,DataCardValue10.SearchText)
                Template: =ListItemTemplate.Person
                Tooltip: =Parent.DisplayName
                Width: =Parent.Width - 60
                X: =30
                Y: =DataCardKey10.Y + DataCardKey10.Height + 5
                ZIndex: =2

            ErrorMessage10 As label:
                AutoHeight: =true
                Height: =10
                Live: =Live.Assertive
                PaddingBottom: =0
                PaddingLeft: =0
                PaddingRight: =0
                PaddingTop: =0
                Text: =Parent.Error
                Visible: =Parent.DisplayMode=DisplayMode.Edit
                Width: =Parent.Width - 60
                X: =30
                Y: =DataCardValue10.Y + DataCardValue10.Height
                ZIndex: =3

            StarVisible10 As label:
                Align: =Align.Center
                Height: =DataCardKey10.Height
                Text: ="*"
                Visible: =And(Parent.Required, Parent.DisplayMode=DisplayMode.Edit)
                Width: =30
                Wrap: =false
                Y: =DataCardKey10.Y
                ZIndex: =4

    ButtonPlannerSave_1 As button:
        BorderColor: =ColorFade(ButtonPlannerSave_1.Fill, -15%)
        Color: =White
        DisplayMode: =If(!CertificateForm.Valid ||!IsBlank(DepartmentNonFieldError.Text) || (IsEmpty(LiscenceFileInput.Attachments) && CertificateForm.Mode=FormMode.New), Disabled, Edit)
        Fill: =ColorValue(PrimaryColor)
        FocusedBorderColor: =ButtonPlannerSave_1.BorderColor
        Font: =Font.'Segoe UI'
        Height: =46
        HoverBorderColor: =ColorFade(ButtonPlannerSave_1.BorderColor, 20%)
        HoverColor: =ButtonPlannerSave_1.Color
        HoverFill: =ColorFade(ButtonPlannerSave_1.Fill, 20%)
        OnSelect: |
            =SubmitForm(CertificateForm); 
        PressedBorderColor: =ButtonPlannerSave_1.Fill
        PressedColor: =ButtonPlannerSave_1.Fill
        PressedFill: =ButtonPlannerSave_1.Color
        RadiusBottomLeft: =1
        RadiusBottomRight: =1
        RadiusTopLeft: =1
        RadiusTopRight: =1
        Size: =16
        Text: ="Save"
        Width: =133
        X: =688
        Y: =665
        ZIndex: =3

    PrevExpirationDate As datepicker:
        DefaultDate: =CertificateList.Selected.ExpirationDate
        Visible: =false
        Width: =286
        X: =944
        Y: =665
        ZIndex: =4

    ExpirationDate_HelpText_1 As label:
        Text: ="If you are setting a new expiration date, please check, otherwise (correcting the mistaken expiration date etc.) leave it unchecked "
        Visible: =CertificateForm.Mode=FormMode.Edit
        Width: =666
        X: =302
        Y: =139
        ZIndex: =7

    Image2 As image:
        Image: =liscenceFile.Thumbnail.Small
        Visible: =CertificateForm.Mode=FormMode.Edit
        X: =288
        Y: =651
        ZIndex: =9

    HtmlText2 As htmlViewer:
        Height: =54
        HtmlText: |-
            ="<a href='https://slb001.sharepoint.com/sites/Documents2/CertificatesStorage/"&liscenceFile.'File name with extension'&"'>View Liscence File</a>"
        Size: =15
        Visible: =CertificateForm.Mode=FormMode.Edit
        Width: =216
        X: =388
        Y: =651
        ZIndex: =10

